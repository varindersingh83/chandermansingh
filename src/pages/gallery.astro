---
import BaseLayout from '../layouts/BaseLayout.astro';
import Container from '../components/Container.astro';
import ClayCard from '../components/ClayCard.astro';

const items = [
  { src: 'project-01.jpg', title: 'Dashboard Exploration', category: 'Product UI' },
  { src: 'project-02.jpg', title: 'Landing Moodboard', category: 'Branding' },
  { src: 'project-03.jpg', title: 'Mobile Workflow', category: 'UX' },
  { src: 'project-04.jpg', title: 'Editorial Concept', category: 'Web Design' },
  { src: 'project-05.jpg', title: 'Interaction Study', category: 'Prototype' },
  { src: 'project-06.jpg', title: 'Commerce System', category: 'Design System' }
];

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<BaseLayout title="Gallery | Chander Singh" description="A selected gallery of design work and visual studies.">
  <Container class="pt-8 sm:pt-10">
    <ClayCard class="space-y-4" interactive>
      <p class="clay-heading text-xs font-black uppercase tracking-[0.2em] text-clay-muted">Visual Library</p>
      <h1 class="text-4xl font-black tracking-tight sm:text-5xl" style={{ fontFamily: 'Nunito, sans-serif' }}>Gallery</h1>
      <p class="max-w-2xl text-base font-medium leading-relaxed text-clay-muted sm:text-lg">
        Replace placeholder files in <code>/public/gallery</code>. Click any card to open the clay lightbox.
      </p>
    </ClayCard>

    <section class="mt-8 grid gap-5 sm:grid-cols-2 lg:grid-cols-3" id="gallery-grid">
      {items.map((item, index) => (
        <button
          class="group overflow-hidden rounded-clayLg border border-white/60 bg-white/75 text-left shadow-clayCard backdrop-blur-xl transition-all duration-500 hover:-translate-y-2 hover:shadow-clayCardHover focus-visible:outline-none focus-visible:ring-4 focus-visible:ring-clay-accent/30"
          data-index={index}
          data-src={`${base}/gallery/${item.src}`}
          data-title={item.title}
          data-category={item.category}
        >
          <img src={`${base}/gallery/${item.src}`} alt={item.title} class="aspect-[4/3] w-full rounded-[24px] object-cover p-2" loading="lazy" />
          <div class="p-5 pt-2">
            <p class="clay-heading text-xl font-extrabold" style={{ fontFamily: 'Nunito, sans-serif' }}>{item.title}</p>
            <p class="mt-1 text-sm font-medium text-clay-muted">{item.category}</p>
          </div>
        </button>
      ))}
    </section>
  </Container>

  <div id="lightbox" class="fixed inset-0 z-50 hidden items-center justify-center bg-[#332F3A]/45 p-4 backdrop-blur-sm" aria-modal="true" role="dialog">
    <div class="relative w-full max-w-5xl rounded-[32px] border border-white/60 bg-white/80 p-4 shadow-clayDeep backdrop-blur-xl">
      <button id="lightbox-close" class="absolute right-4 top-4 inline-flex h-11 items-center rounded-clayXs bg-white/90 px-4 text-sm font-bold shadow-clayButton transition-all duration-200 hover:-translate-y-1 hover:shadow-clayButtonHover active:scale-[0.92] active:shadow-clayPressed">Close</button>
      <img id="lightbox-image" src="" alt="" class="max-h-[72vh] w-full rounded-[24px] object-contain" />
      <div class="mt-3 flex flex-wrap items-center justify-between gap-3">
        <div>
          <p id="lightbox-title" class="clay-heading text-xl font-black" style={{ fontFamily: 'Nunito, sans-serif' }}></p>
          <p id="lightbox-category" class="text-sm font-medium text-clay-muted"></p>
        </div>
        <div class="flex gap-2">
          <button id="lightbox-prev" class="inline-flex h-11 items-center rounded-clayXs bg-white/90 px-4 text-sm font-bold shadow-clayButton transition-all duration-200 hover:-translate-y-1 hover:shadow-clayButtonHover active:scale-[0.92] active:shadow-clayPressed">Prev</button>
          <button id="lightbox-next" class="inline-flex h-11 items-center rounded-clayXs bg-white/90 px-4 text-sm font-bold shadow-clayButton transition-all duration-200 hover:-translate-y-1 hover:shadow-clayButtonHover active:scale-[0.92] active:shadow-clayPressed">Next</button>
        </div>
      </div>
    </div>
  </div>

  <script is:inline>
    const lightbox = document.getElementById('lightbox');
    const image = document.getElementById('lightbox-image');
    const title = document.getElementById('lightbox-title');
    const category = document.getElementById('lightbox-category');
    const closeBtn = document.getElementById('lightbox-close');
    const prevBtn = document.getElementById('lightbox-prev');
    const nextBtn = document.getElementById('lightbox-next');
    const cards = Array.from(document.querySelectorAll('#gallery-grid [data-index]'));

    let current = -1;

    function openLightbox(index) {
      const card = cards[index];
      if (!card) return;
      current = index;
      image.src = card.dataset.src || '';
      image.alt = card.dataset.title || 'Gallery image';
      title.textContent = card.dataset.title || '';
      category.textContent = card.dataset.category || '';
      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');
    }

    function closeLightbox() {
      lightbox.classList.add('hidden');
      lightbox.classList.remove('flex');
      image.src = '';
      current = -1;
    }

    function move(delta) {
      if (!cards.length) return;
      const next = (current + delta + cards.length) % cards.length;
      openLightbox(next);
    }

    cards.forEach((card, index) => {
      card.addEventListener('click', () => openLightbox(index));
    });

    closeBtn.addEventListener('click', closeLightbox);
    prevBtn.addEventListener('click', () => move(-1));
    nextBtn.addEventListener('click', () => move(1));

    lightbox.addEventListener('click', (event) => {
      if (event.target === lightbox) closeLightbox();
    });

    window.addEventListener('keydown', (event) => {
      if (lightbox.classList.contains('hidden')) return;
      if (event.key === 'Escape') closeLightbox();
      if (event.key === 'ArrowLeft') move(-1);
      if (event.key === 'ArrowRight') move(1);
    });
  </script>
</BaseLayout>
